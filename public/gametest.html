<!DOCTYPE html>
<html>
<head>
    <title>Title of the document</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/jquery-2.2.1.min.js"></script>
    <script src="client.js"></script>
    <script src="game.js"></script>
    <style>
        #pack {
            background-color: green;
            position: absolute;
            top: 50px;
            right: 50px;
        }

        #stack {
            background-color: yellow;
            position: absolute;
            left: 50px;
        }

        #hand {
            background-color: red;
            position: absolute;
            bottom: 80px;
        }

        #hand2 {
            background-color: blue;
            position: absolute;
            bottom: 20px;
        }

        #topcard {
            position: absolute;
            top: 45%;
            right: 42%;
            height: 120px;
            width: 120px;
            font-size: xx-large;
            text-align: center;
        }

        .cardbtn {
            width: 50px;
        }

        .draw {
            background-color: aqua;
        }

        .green {
            background-color: lawngreen;
        }
    </style>
</head>

<body>
    <script>
        // Setup configuratie
        var jokers = 2; // Aantal jokers in het spel
        var cards = 7; // Beginkaarten
        var five = false; // Vijf pak een wijf regel
        var takelast = 2; // 2 of 5 pakken gebruikelijk, als je met een pestkaart uitkomt

        // Test variablen
        var hand = [];
        var hand2 = [];
        var topcard;

        function topc(card) {
            var fancyCard = fancy(card);
            return "<i>" + fancyCard.suit + "</i><br /><b>" + fancyCard.card + "</b>";
        }

        function cardhtml(card) {
            return "<b>" + card.card + "</b><i>" + card.suit + "</i><br />";
        }

        function cardbutton(index, card, player) {
            var green = "";
            var disabled = "";
            if (possible(card))
                green = ' green';
            if (turn != player)
                disabled = 'disabled="true"';
            return '<button ' + disabled + ' class="cardbtn ' + green + '" onclick="putbutton(' + index + "," + player + ');">' + card.card + card.suit + '</button>';
        }

        function drawbutton(player) {
            if (player == 1) {
                draw(1, hand);
                if (!possible(hand[hand.length - 1]))
                    next();
            } else if (player == 2) {
                draw(1, hand2);
                if (!possible(hand2[hand2.length - 1]))
                    next();
            }
            init();
        }

        function putbutton(index, player) {
            if (player == 1) {
                play(index, hand);
                //alert(possible(hand[index]));
            } else if (player == 2) {
                play(index, hand2);
                //alert(possible(hand2[index]));
            }
            init();
        }

        function init() {
            //console.log("init");
            //console.log({ "pack": pack, "stack": stack, "hand": hand, "hand2": hand2 });
            //console.log(pack);
            var handhtml = "", hand2html = "", stackhtml = "", packhtml = "", topcardhtml = "";

            $.each(pack, function (index, card) {
                if (card)
                    packhtml += cardhtml(card);
            });

            if (stack.length != 0) {
                topcard = stack[stack.length - 1]
                topcardhtml = topc(topcard);
            }

            var pos1 = true;
            $.each(hand, function (index, card) {
                if (card)
                    handhtml += cardbutton(index, card, 1);
                if (possible(card))
                    pos1 = false;
            });
            if (pos1 && turn == 1) { // Automate all the things
                console.log("Player 1 kan niet spelen, pakt 1, totaal aantal kaarten " + (hand.length + 1));
                drawbutton(1);
                return;
            }

            var pos2 = true;
            $.each(hand2, function (index, card) {
                if (card)
                    hand2html += cardbutton(index, card, 2);
                if (possible(card))
                    pos2 = false;
            });
            if (pos2 && turn == 2) { // Automate all the things
                console.log("Player 2 kan niet spelen, pakt 1, totaal aantal kaarten " + (hand2.length + 1));
                drawbutton(2);
                return;
            }

            $.each(stack, function (index, card) {
                if (card)
                    stackhtml += cardhtml(card);
            });

            var total = hand.length + hand2.length + stack.length + pack.length;

            $("h3").html("Aantal kaarten in pot: " + pack.length + " || Aantal pakken: " + takeAmount + " || Turn: " + turn);
            $('#pack').html("<u>Pot:</u> <br />" + packhtml);
            $('#stack').html("<u>Aflegstapel:</u> <br />" + stackhtml);
            $('#hand').html("Player 1:" + handhtml + '<button class="draw" onclick="drawbutton(1);">Draw</button><button class="knock" id="knock1" onclick="knockknock(1);" disabled="true">KnockKnock</button>');
            $('#hand2').html("Player 2:" + hand2html + '<button class="draw" onclick="drawbutton(2);">Draw</button><button class="knock" id="knock2" onclick="knockknock(2);" disabled="true">KnockKnock</button>');
            $('#topcard').html(topcardhtml);

            $.each(players, function (index, player) {
                if (player.hand.length == 1)
                    $("#knock" + index).prop("disabled", false);;
                if (player.knockknock)
                    $("#knock" + index).addClass("green");
            });
        }

        $(document).ready(function () {
            pack = create(jokers);
            shuffle();
            hand = draw(cards, hand); // Kaarten delen
            hand2 = draw(cards, hand2);

            var players = [
                { name: "Player 1", hand: hand, knockknock: false },
                { name: "Player 2", hand: hand2, knockknock: false }
            ];
            $.each(players, function (index, player) {
                player.hand.sort(function (a, b) {
                    return a.suit - b.suit; // Sorteer op symbool
                })
            });
            var config = {
                jokers: 2,
                cards: 7,
                five: false,
                takelast: 2
            };

            setconfig(config, players);
            start();
            console.log("Startkaart: " + fancy(stack[stack.length - 1], true));

            init();
        });
    </script>

    <h1>Pagina waar het spel gespeeld wordt</h1>
    <h2 class="server-name">Helemaal niet</h2>
    <h3></h3>
    <div class="">
        <div id="pack"></div>
        <div id="stack"></div>
        <div id="topcard"></div>
        <div id="hand"></div>
        <div id="hand2"></div>
    </div>
</body>
</html>